package main

import (
	"io/ioutil"
	"os"
	"regexp"
	"sort"
	"strconv"
	"time"

	"github.com/dghubble/go-twitter/twitter"
	"github.com/dghubble/oauth1"
	"github.com/joho/godotenv"
)

var EmojiPattern = regexp.MustCompile("â–ªâ–«â–¶â—€â—»â—¼â˜€-â˜„â˜Žâ˜‘â˜˜â˜ â˜¢â˜£â˜¦â˜ªâ˜®â˜¯â˜¸-â˜ºâ™€â™‚â™Ÿâ™ â™£â™¥â™¦â™¨â™»â™¾âš’âš”-âš—âš™âš›âšœâš âš§âš°âš±â›ˆâ›â›‘â›“â›©â›°â›±â›´â›·â›¸âœ‚âœˆâœ‰âœâœ’âœ”âœ–âœâœ¡âœ³âœ´â„â‡â£âž¡â¤´â¤µâ¬…-â¬‡ã€°ã€½ãŠ—ãŠ™ðŸ…°ðŸ…±ðŸ…¾ðŸ…¿ðŸˆ‚ðŸˆ·ðŸŒ¡ðŸŒ¤-ðŸŒ¬ðŸŒ¶ðŸ½ðŸŽ–ðŸŽ—ðŸŽ™-ðŸŽ›ðŸŽžðŸŽŸðŸðŸŽðŸ”-ðŸŸðŸµðŸ·ðŸ¿ðŸ“½ðŸ•‰ðŸ•ŠðŸ•¯ðŸ•°ðŸ•³ðŸ•¶-ðŸ•¹ðŸ–‡ðŸ–Š-ðŸ–ðŸ–¥ðŸ–¨ðŸ–±ðŸ–²ðŸ–¼ðŸ—‚-ðŸ—„ðŸ—‘-ðŸ—“ðŸ—œ-ðŸ—žðŸ—¡ðŸ—£ðŸ—¨ðŸ—¯ðŸ—³ðŸ—ºðŸ›‹ðŸ›-ðŸ›ðŸ› -ðŸ›¥ðŸ›©ðŸ›°ðŸ›³]ï¸?|[â˜âœŒâœðŸ•´ðŸ–][ï¸ðŸ»-ðŸ¿]?|[â›¹ðŸ‹ðŸŒðŸ•µ](?:â€[â™€â™‚]ï¸?|[ï¸ðŸ»-ðŸ¿](?:â€[â™€â™‚]ï¸?)?)?|[âœŠâœ‹ðŸŽ…ðŸ‚ðŸ‡ðŸ‘‚ðŸ‘ƒðŸ‘†-ðŸ‘ðŸ‘¦ðŸ‘§ðŸ‘«-ðŸ‘­ðŸ‘²ðŸ‘´-ðŸ‘¶ðŸ‘¸ðŸ‘¼ðŸ’ƒðŸ’…ðŸ’ðŸ’‘ðŸ’ªðŸ•ºðŸ–•ðŸ––ðŸ™ŒðŸ™ðŸ›€ðŸ›ŒðŸ¤ŒðŸ¤ðŸ¤˜-ðŸ¤ŸðŸ¤°-ðŸ¤´ðŸ¤¶ðŸ¥·ðŸ¦µðŸ¦¶ðŸ¦»ðŸ§’ðŸ§“ðŸ§•ðŸ«ƒ-ðŸ«…ðŸ«°ðŸ«²-ðŸ«¶][ðŸ»-ðŸ¿]?|â¤(?:â€[ðŸ”¥ðŸ©¹]|ï¸(?:â€[ðŸ”¥ðŸ©¹])?)?|ðŸ‡¦[ðŸ‡¨-ðŸ‡¬ðŸ‡®ðŸ‡±ðŸ‡²ðŸ‡´ðŸ‡¶-ðŸ‡ºðŸ‡¼ðŸ‡½ðŸ‡¿]|ðŸ‡§[ðŸ‡¦ðŸ‡§ðŸ‡©-ðŸ‡¯ðŸ‡±-ðŸ‡´ðŸ‡¶-ðŸ‡¹ðŸ‡»ðŸ‡¼ðŸ‡¾ðŸ‡¿]|ðŸ‡¨[ðŸ‡¦ðŸ‡¨ðŸ‡©ðŸ‡«-ðŸ‡®ðŸ‡°-ðŸ‡µðŸ‡·ðŸ‡º-ðŸ‡¿]|ðŸ‡©[ðŸ‡ªðŸ‡¬ðŸ‡¯ðŸ‡°ðŸ‡²ðŸ‡´ðŸ‡¿]|ðŸ‡ª[ðŸ‡¦ðŸ‡¨ðŸ‡ªðŸ‡¬ðŸ‡­ðŸ‡·-ðŸ‡º]|ðŸ‡«[ðŸ‡®-ðŸ‡°ðŸ‡²ðŸ‡´ðŸ‡·]|ðŸ‡¬[ðŸ‡¦ðŸ‡§ðŸ‡©-ðŸ‡®ðŸ‡±-ðŸ‡³ðŸ‡µ-ðŸ‡ºðŸ‡¼ðŸ‡¾]|ðŸ‡­[ðŸ‡°ðŸ‡²ðŸ‡³ðŸ‡·ðŸ‡¹ðŸ‡º]|ðŸ‡®[ðŸ‡¨-ðŸ‡ªðŸ‡±-ðŸ‡´ðŸ‡¶-ðŸ‡¹]|ðŸ‡¯[ðŸ‡ªðŸ‡²ðŸ‡´ðŸ‡µ]|ðŸ‡°[ðŸ‡ªðŸ‡¬-ðŸ‡®ðŸ‡²ðŸ‡³ðŸ‡µðŸ‡·ðŸ‡¼ðŸ‡¾ðŸ‡¿]|ðŸ‡±[ðŸ‡¦-ðŸ‡¨ðŸ‡®ðŸ‡°ðŸ‡·-ðŸ‡»ðŸ‡¾]|ðŸ‡²[ðŸ‡¦ðŸ‡¨-ðŸ‡­ðŸ‡°-ðŸ‡¿]|ðŸ‡³[ðŸ‡¦ðŸ‡¨ðŸ‡ª-ðŸ‡¬ðŸ‡®ðŸ‡±ðŸ‡´ðŸ‡µðŸ‡·ðŸ‡ºðŸ‡¿]|ðŸ‡´ðŸ‡²|ðŸ‡µ[ðŸ‡¦ðŸ‡ª-ðŸ‡­ðŸ‡°-ðŸ‡³ðŸ‡·-ðŸ‡¹ðŸ‡¼ðŸ‡¾]|ðŸ‡¶ðŸ‡¦|ðŸ‡·[ðŸ‡ªðŸ‡´ðŸ‡¸ðŸ‡ºðŸ‡¼]|ðŸ‡¸[ðŸ‡¦-ðŸ‡ªðŸ‡¬-ðŸ‡´ðŸ‡·-ðŸ‡¹ðŸ‡»ðŸ‡½-ðŸ‡¿]|ðŸ‡¹[ðŸ‡¦ðŸ‡¨ðŸ‡©ðŸ‡«-ðŸ‡­ðŸ‡¯-ðŸ‡´ðŸ‡·ðŸ‡¹ðŸ‡»ðŸ‡¼ðŸ‡¿]|ðŸ‡º[ðŸ‡¦ðŸ‡¬ðŸ‡²ðŸ‡³ðŸ‡¸ðŸ‡¾ðŸ‡¿]|ðŸ‡»[ðŸ‡¦ðŸ‡¨ðŸ‡ªðŸ‡¬ðŸ‡®ðŸ‡³ðŸ‡º]|ðŸ‡¼[ðŸ‡«ðŸ‡¸]|ðŸ‡½ðŸ‡°|ðŸ‡¾[ðŸ‡ªðŸ‡¹]|ðŸ‡¿[ðŸ‡¦ðŸ‡²ðŸ‡¼]|[ðŸƒðŸ„ðŸŠðŸ‘®ðŸ‘°ðŸ‘±ðŸ‘³ðŸ‘·ðŸ’ðŸ’‚ðŸ’†ðŸ’‡ðŸ™…-ðŸ™‡ðŸ™‹ðŸ™ðŸ™ŽðŸš£ðŸš´-ðŸš¶ðŸ¤¦ðŸ¤µðŸ¤·-ðŸ¤¹ðŸ¤½ðŸ¤¾ðŸ¦¸ðŸ¦¹ðŸ§-ðŸ§ðŸ§”ðŸ§–-ðŸ§](?:â€[â™€â™‚]ï¸?|[ðŸ»-ðŸ¿](?:â€[â™€â™‚]ï¸?)?)?|ðŸ³(?:â€(?:âš§ï¸?|ðŸŒˆ)|ï¸(?:â€(?:âš§ï¸?|ðŸŒˆ))?)?|ðŸ´(?:â€â˜ ï¸?|ó §ó ¢(?:ó ¥ó ®ó §|ó ³ó £ó ´|ó ·ó ¬ó ³)ó ¿)?|ðŸˆ(?:â€â¬›)?|ðŸ•(?:â€ðŸ¦º)?|ðŸ»(?:â€â„ï¸?)?|ðŸ‘(?:â€ðŸ—¨ï¸?|ï¸(?:â€ðŸ—¨ï¸?)?)?|ðŸ‘¨(?:â€(?:[âš•âš–âœˆ]ï¸?|â¤ï¸?â€(?:ðŸ’‹â€)?ðŸ‘¨|ðŸ‘¦(?:â€ðŸ‘¦)?|ðŸ‘§(?:â€[ðŸ‘¦ðŸ‘§])?|[ðŸ‘¨ðŸ‘©]â€(?:ðŸ‘¦(?:â€ðŸ‘¦)?|ðŸ‘§(?:â€[ðŸ‘¦ðŸ‘§])?)|[ðŸŒ¾ðŸ³ðŸ¼ðŸŽ“ðŸŽ¤ðŸŽ¨ðŸ«ðŸ­ðŸ’»ðŸ’¼ðŸ”§ðŸ”¬ðŸš€ðŸš’ðŸ¦¯-ðŸ¦³ðŸ¦¼ðŸ¦½])|ðŸ»(?:â€(?:[âš•âš–âœˆ]ï¸?|â¤ï¸?â€(?:ðŸ’‹â€)?ðŸ‘¨[ðŸ»-ðŸ¿]|ðŸ¤â€ðŸ‘¨[ðŸ¼-ðŸ¿]|[ðŸŒ¾ðŸ³ðŸ¼ðŸŽ“ðŸŽ¤ðŸŽ¨ðŸ«ðŸ­ðŸ’»ðŸ’¼ðŸ”§ðŸ”¬ðŸš€ðŸš’ðŸ¦¯-ðŸ¦³ðŸ¦¼ðŸ¦½]))?|ðŸ¼(?:â€(?:[âš•âš–âœˆ]ï¸?|â¤ï¸?â€(?:ðŸ’‹â€)?ðŸ‘¨[ðŸ»-ðŸ¿]|ðŸ¤â€ðŸ‘¨[ðŸ»ðŸ½-ðŸ¿]|[ðŸŒ¾ðŸ³ðŸ¼ðŸŽ“ðŸŽ¤ðŸŽ¨ðŸ«ðŸ­ðŸ’»ðŸ’¼ðŸ”§ðŸ”¬ðŸš€ðŸš’ðŸ¦¯-ðŸ¦³ðŸ¦¼ðŸ¦½]))?|ðŸ½(?:â€(?:[âš•âš–âœˆ]ï¸?|â¤ï¸?â€(?:ðŸ’‹â€)?ðŸ‘¨[ðŸ»-ðŸ¿]|ðŸ¤â€ðŸ‘¨[ðŸ»ðŸ¼ðŸ¾ðŸ¿]|[ðŸŒ¾ðŸ³ðŸ¼ðŸŽ“ðŸŽ¤ðŸŽ¨ðŸ«ðŸ­ðŸ’»ðŸ’¼ðŸ”§ðŸ”¬ðŸš€ðŸš’ðŸ¦¯-ðŸ¦³ðŸ¦¼ðŸ¦½]))?|ðŸ¾(?:â€(?:[âš•âš–âœˆ]ï¸?|â¤ï¸?â€(?:ðŸ’‹â€)?ðŸ‘¨[ðŸ»-ðŸ¿]|ðŸ¤â€ðŸ‘¨[ðŸ»-ðŸ½ðŸ¿]|[ðŸŒ¾ðŸ³ðŸ¼ðŸŽ“ðŸŽ¤ðŸŽ¨ðŸ«ðŸ­ðŸ’»ðŸ’¼ðŸ”§ðŸ”¬ðŸš€ðŸš’ðŸ¦¯-ðŸ¦³ðŸ¦¼ðŸ¦½]))?|ðŸ¿(?:â€(?:[âš•âš–âœˆ]ï¸?|â¤ï¸?â€(?:ðŸ’‹â€)?ðŸ‘¨[ðŸ»-ðŸ¿]|ðŸ¤â€ðŸ‘¨[ðŸ»-ðŸ¾]|[ðŸŒ¾ðŸ³ðŸ¼ðŸŽ“ðŸŽ¤ðŸŽ¨ðŸ«ðŸ­ðŸ’»ðŸ’¼ðŸ”§ðŸ”¬ðŸš€ðŸš’ðŸ¦¯-ðŸ¦³ðŸ¦¼ðŸ¦½]))?)?|ðŸ‘©(?:â€(?:[âš•âš–âœˆ]ï¸?|â¤ï¸?â€(?:[ðŸ‘¨ðŸ‘©]|ðŸ’‹â€[ðŸ‘¨ðŸ‘©])|ðŸ‘¦(?:â€ðŸ‘¦)?|ðŸ‘§(?:â€[ðŸ‘¦ðŸ‘§])?|ðŸ‘©â€(?:ðŸ‘¦(?:â€ðŸ‘¦)?|ðŸ‘§(?:â€[ðŸ‘¦ðŸ‘§])?)|[ðŸŒ¾ðŸ³ðŸ¼ðŸŽ“ðŸŽ¤ðŸŽ¨ðŸ«ðŸ­ðŸ’»ðŸ’¼ðŸ”§ðŸ”¬ðŸš€ðŸš’ðŸ¦¯-ðŸ¦³ðŸ¦¼ðŸ¦½])|ðŸ»(?:â€(?:[âš•âš–âœˆ]ï¸?|â¤ï¸?â€(?:ðŸ’‹â€)?[ðŸ‘¨ðŸ‘©][ðŸ»-ðŸ¿]|ðŸ¤â€[ðŸ‘¨ðŸ‘©][ðŸ¼-ðŸ¿]|[ðŸŒ¾ðŸ³ðŸ¼ðŸŽ“ðŸŽ¤ðŸŽ¨ðŸ«ðŸ­ðŸ’»ðŸ’¼ðŸ”§ðŸ”¬ðŸš€ðŸš’ðŸ¦¯-ðŸ¦³ðŸ¦¼ðŸ¦½]))?|ðŸ¼(?:â€(?:[âš•âš–âœˆ]ï¸?|â¤ï¸?â€(?:ðŸ’‹â€)?[ðŸ‘¨ðŸ‘©][ðŸ»-ðŸ¿]|ðŸ¤â€[ðŸ‘¨ðŸ‘©][ðŸ»ðŸ½-ðŸ¿]|[ðŸŒ¾ðŸ³ðŸ¼ðŸŽ“ðŸŽ¤ðŸŽ¨ðŸ«ðŸ­ðŸ’»ðŸ’¼ðŸ”§ðŸ”¬ðŸš€ðŸš’ðŸ¦¯-ðŸ¦³ðŸ¦¼ðŸ¦½]))?|ðŸ½(?:â€(?:[âš•âš–âœˆ]ï¸?|â¤ï¸?â€(?:ðŸ’‹â€)?[ðŸ‘¨ðŸ‘©][ðŸ»-ðŸ¿]|ðŸ¤â€[ðŸ‘¨ðŸ‘©][ðŸ»ðŸ¼ðŸ¾ðŸ¿]|[ðŸŒ¾ðŸ³ðŸ¼ðŸŽ“ðŸŽ¤ðŸŽ¨ðŸ«ðŸ­ðŸ’»ðŸ’¼ðŸ”§ðŸ”¬ðŸš€ðŸš’ðŸ¦¯-ðŸ¦³ðŸ¦¼ðŸ¦½]))?|ðŸ¾(?:â€(?:[âš•âš–âœˆ]ï¸?|â¤ï¸?â€(?:ðŸ’‹â€)?[ðŸ‘¨ðŸ‘©][ðŸ»-ðŸ¿]|ðŸ¤â€[ðŸ‘¨ðŸ‘©][ðŸ»-ðŸ½ðŸ¿]|[ðŸŒ¾ðŸ³ðŸ¼ðŸŽ“ðŸŽ¤ðŸŽ¨ðŸ«ðŸ­ðŸ’»ðŸ’¼ðŸ”§ðŸ”¬ðŸš€ðŸš’ðŸ¦¯-ðŸ¦³ðŸ¦¼ðŸ¦½]))?|ðŸ¿(?:â€(?:[âš•âš–âœˆ]ï¸?|â¤ï¸?â€(?:ðŸ’‹â€)?[ðŸ‘¨ðŸ‘©][ðŸ»-ðŸ¿]|ðŸ¤â€[ðŸ‘¨ðŸ‘©][ðŸ»-ðŸ¾]|[ðŸŒ¾ðŸ³ðŸ¼ðŸŽ“ðŸŽ¤ðŸŽ¨ðŸ«ðŸ­ðŸ’»ðŸ’¼ðŸ”§ðŸ”¬ðŸš€ðŸš’ðŸ¦¯-ðŸ¦³ðŸ¦¼ðŸ¦½]))?)?|[ðŸ‘¯ðŸ¤¼ðŸ§žðŸ§Ÿ](?:â€[â™€â™‚]ï¸?)?|ðŸ˜®(?:â€ðŸ’¨)?|ðŸ˜µ(?:â€ðŸ’«)?|ðŸ˜¶(?:â€ðŸŒ«ï¸?)?|ðŸ§‘(?:â€(?:[âš•âš–âœˆ]ï¸?|ðŸ¤â€ðŸ§‘|[ðŸŒ¾ðŸ³ðŸ¼ðŸŽ„ðŸŽ“ðŸŽ¤ðŸŽ¨ðŸ«ðŸ­ðŸ’»ðŸ’¼ðŸ”§ðŸ”¬ðŸš€ðŸš’ðŸ¦¯-ðŸ¦³ðŸ¦¼ðŸ¦½])|ðŸ»(?:â€(?:[âš•âš–âœˆ]ï¸?|â¤ï¸?â€(?:ðŸ’‹â€)?ðŸ§‘[ðŸ¼-ðŸ¿]|ðŸ¤â€ðŸ§‘[ðŸ»-ðŸ¿]|[ðŸŒ¾ðŸ³ðŸ¼ðŸŽ„ðŸŽ“ðŸŽ¤ðŸŽ¨ðŸ«ðŸ­ðŸ’»ðŸ’¼ðŸ”§ðŸ”¬ðŸš€ðŸš’ðŸ¦¯-ðŸ¦³ðŸ¦¼ðŸ¦½]))?|ðŸ¼(?:â€(?:[âš•âš–âœˆ]ï¸?|â¤ï¸?â€(?:ðŸ’‹â€)?ðŸ§‘[ðŸ»ðŸ½-ðŸ¿]|ðŸ¤â€ðŸ§‘[ðŸ»-ðŸ¿]|[ðŸŒ¾ðŸ³ðŸ¼ðŸŽ„ðŸŽ“ðŸŽ¤ðŸŽ¨ðŸ«ðŸ­ðŸ’»ðŸ’¼ðŸ”§ðŸ”¬ðŸš€ðŸš’ðŸ¦¯-ðŸ¦³ðŸ¦¼ðŸ¦½]))?|ðŸ½(?:â€(?:[âš•âš–âœˆ]ï¸?|â¤ï¸?â€(?:ðŸ’‹â€)?ðŸ§‘[ðŸ»ðŸ¼ðŸ¾ðŸ¿]|ðŸ¤â€ðŸ§‘[ðŸ»-ðŸ¿]|[ðŸŒ¾ðŸ³ðŸ¼ðŸŽ„ðŸŽ“ðŸŽ¤ðŸŽ¨ðŸ«ðŸ­ðŸ’»ðŸ’¼ðŸ”§ðŸ”¬ðŸš€ðŸš’ðŸ¦¯-ðŸ¦³ðŸ¦¼ðŸ¦½]))?|ðŸ¾(?:â€(?:[âš•âš–âœˆ]ï¸?|â¤ï¸?â€(?:ðŸ’‹â€)?ðŸ§‘[ðŸ»-ðŸ½ðŸ¿]|ðŸ¤â€ðŸ§‘[ðŸ»-ðŸ¿]|[ðŸŒ¾ðŸ³ðŸ¼ðŸŽ„ðŸŽ“ðŸŽ¤ðŸŽ¨ðŸ«ðŸ­ðŸ’»ðŸ’¼ðŸ”§ðŸ”¬ðŸš€ðŸš’ðŸ¦¯-ðŸ¦³ðŸ¦¼ðŸ¦½]))?|ðŸ¿(?:â€(?:[âš•âš–âœˆ]ï¸?|â¤ï¸?â€(?:ðŸ’‹â€)?ðŸ§‘[ðŸ»-ðŸ¾]|ðŸ¤â€ðŸ§‘[ðŸ»-ðŸ¿]|[ðŸŒ¾ðŸ³ðŸ¼ðŸŽ„ðŸŽ“ðŸŽ¤ðŸŽ¨ðŸ«ðŸ­ðŸ’»ðŸ’¼ðŸ”§ðŸ”¬ðŸš€ðŸš’ðŸ¦¯-ðŸ¦³ðŸ¦¼ðŸ¦½]))?)?|[âŒšâŒ›â©-â¬â°â³â—½â—¾â˜”â˜•â™ˆ-â™“â™¿âš“âš¡âšªâš«âš½âš¾â›„â›…â›Žâ›”â›ªâ›²â›³â›µâ›ºâ›½âœ…âœ¨âŒâŽâ“-â•â—âž•-âž—âž°âž¿â¬›â¬œâ­â­•ðŸ€„ðŸƒðŸ†ŽðŸ†‘-ðŸ†šðŸˆðŸˆšðŸˆ¯ðŸˆ²-ðŸˆ¶ðŸˆ¸-ðŸˆºðŸ‰ðŸ‰‘ðŸŒ€-ðŸŒ ðŸŒ­-ðŸŒµðŸŒ·-ðŸ¼ðŸ¾-ðŸŽ„ðŸŽ†-ðŸŽ“ðŸŽ -ðŸðŸ…ðŸ†ðŸˆðŸ‰ðŸ-ðŸ“ðŸ -ðŸ°ðŸ¸-ðŸ‡ðŸ‰-ðŸ”ðŸ–-ðŸºðŸ¼-ðŸ¾ðŸ‘€ðŸ‘„ðŸ‘…ðŸ‘‘-ðŸ‘¥ðŸ‘ªðŸ‘¹-ðŸ‘»ðŸ‘½-ðŸ’€ðŸ’„ðŸ’ˆ-ðŸ’ŽðŸ’ðŸ’’-ðŸ’©ðŸ’«-ðŸ“¼ðŸ“¿-ðŸ”½ðŸ•‹-ðŸ•ŽðŸ•-ðŸ•§ðŸ–¤ðŸ—»-ðŸ˜­ðŸ˜¯-ðŸ˜´ðŸ˜·-ðŸ™„ðŸ™ˆ-ðŸ™ŠðŸš€-ðŸš¢ðŸš¤-ðŸš³ðŸš·-ðŸš¿ðŸ›-ðŸ›…ðŸ›-ðŸ›’ðŸ›•-ðŸ›—ðŸ›-ðŸ›ŸðŸ›«ðŸ›¬ðŸ›´-ðŸ›¼ðŸŸ -ðŸŸ«ðŸŸ°ðŸ¤ðŸ¤ŽðŸ¤-ðŸ¤—ðŸ¤ -ðŸ¤¥ðŸ¤§-ðŸ¤¯ðŸ¤ºðŸ¤¿-ðŸ¥…ðŸ¥‡-ðŸ¥¶ðŸ¥¸-ðŸ¦´ðŸ¦·ðŸ¦ºðŸ¦¼-ðŸ§ŒðŸ§ðŸ§ -ðŸ§¿ðŸ©°-ðŸ©´ðŸ©¸-ðŸ©¼ðŸª€-ðŸª†ðŸª-ðŸª¬ðŸª°-ðŸªºðŸ«€-ðŸ«‚ðŸ«-ðŸ«™ðŸ« -ðŸ«§]|ðŸ«±(?:ðŸ»(?:â€ðŸ«²[ðŸ¼-ðŸ¿])?|ðŸ¼(?:â€ðŸ«²[ðŸ»ðŸ½-ðŸ¿])?|ðŸ½(?:â€ðŸ«²[ðŸ»ðŸ¼ðŸ¾ðŸ¿])?|ðŸ¾(?:â€ðŸ«²[ðŸ»-ðŸ½ðŸ¿])?|ðŸ¿(?:â€ðŸ«²[ðŸ»-ðŸ¾])?)?")

func main() {

	godotenv.Load()

	config := oauth1.NewConfig(os.Getenv("API_KEY"), os.Getenv("API_SECRET"))
	token := oauth1.NewToken(os.Getenv("ACCESS_KEY"), os.Getenv("ACCESS_SECRET"))

	httpClient := config.Client(oauth1.NoContext, token)

	client := twitter.NewClient(httpClient)

	start(client)
}

func getLastId() int64 {
	if _, err := os.Stat("last_id.txt"); os.IsNotExist(err) {
		return 0
	}
	file, err := ioutil.ReadFile("last_id.txt")
	if err != nil {
		return 0
	}
	data, err := strconv.Atoi(string(file))
	if err != nil {
		return 0
	}
	return int64(data)
}

func setLastId(id int64) {
	ioutil.WriteFile("last_id.txt", []byte(strconv.Itoa(int(id))), 0644)
}

func start(client *twitter.Client) {
	for {
		println("Starting...")
		lastId := getLastId()
		println("Last id: " + strconv.Itoa(int(lastId)))
		tweets, _, err := client.Timelines.MentionTimeline(&twitter.MentionTimelineParams{
			Count:   200,
			SinceID: lastId,
		})
		if err != nil {
			panic(err)
		}
		if len(tweets) > 0 {
			sort.Slice(tweets, func(i, j int) bool { return tweets[i].ID > tweets[j].ID })
			setLastId(tweets[0].ID)
			for _, tweet := range tweets {
				processTweet(client, tweet)
			}
		} else {
			println("No new tweets")
		}
		time.Sleep(time.Second * 15)
	}
}

func processTweet(client *twitter.Client, tweet twitter.Tweet) {
	println("Received tweet: " + tweet.Text)
	println("URL: " + "https://twitter.com/" + tweet.User.ScreenName + "/status/" + tweet.IDStr)
	println(tweet.InReplyToStatusID)
	if tweet.InReplyToStatusID == 0 {
		replyTweet, _, err := client.Statuses.Update(
			"@"+tweet.User.ScreenName+"\n"+
				"Hello! Sorry, but this bot only responds to tweets that are replies to other tweets.\n"+
				"Please mention me in a reply!",
			&twitter.StatusUpdateParams{
				InReplyToStatusID: tweet.ID,
			},
		)
		if err != nil {
			println("An error occurred: " + err.Error())
		} else {
			println("Replied help, https://twitter.com/" + replyTweet.User.ScreenName + "/status/" + replyTweet.IDStr)
		}
		return
	}
	replyTweets, _, err := client.Statuses.Lookup([]int64{tweet.InReplyToStatusID}, nil)
	if err != nil || len(replyTweets) == 0 {
		return
	}
	replyTweet := replyTweets[0]
	text := replyTweet.Text
	replaced := EmojiPattern.ReplaceAllString(text, "ðŸ’©")
	replaceReplyTweet, _, err := client.Statuses.Update(
		"@"+replyTweet.User.ScreenName+"\n"+replaced,
		&twitter.StatusUpdateParams{
			InReplyToStatusID: tweet.ID,
		},
	)
	if err != nil {
		println("An error occurred: " + err.Error())
	} else {
		println("Replied with replaced text, https://twitter.com/" + replaceReplyTweet.User.ScreenName + "/status/" + replaceReplyTweet.IDStr)
	}
}
